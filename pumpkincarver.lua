local a=math.pi;local b=math.cos;local c=math.sin;local d=math.sqrt;local e=require("PineWorks")local f=require("betterblittle")local g=e.scene.new()term.setBackgroundColor(colors.yellow)term.setTextColor(colors.white)term.clear()term.setCursorPos(1,3)print("Getting ready. This can take a few seconds...")local h,i=term.getSize()local j={controlBar=g.hud:addWindow(1,i,h,1),subMenu=g.hud:addWindow(1,i+1,1,1)}local k={"Save","Load","New","Showcase","Hide","Exit"}local l=1;local m=1;local n=false;local o=false;local p=false;local q=""local r=math.pi*0.5;local s=math.pi*0.5;local t=1.5;local u=7;local v=3;local w=math.pi;local x=math.pi;local y=math.pi*1.125;local z=math.pi*0.5;local A=250;local B=_HOST and _HOST:find("luajit")and true or false;if B then e.log("Running LuaJIT")A=50 else e.log("Running normal Lua")end;local C=0;local D=false;local E={colors.red,colors.orange,colors.yellow,colors.lime,colors.green,colors.cyan,colors.blue}local function F(G)local H=math.floor(math.max(0,math.min(0.9999,G))*#E)+1;return E[H]end;local function I(J)for H=1,#J do local K=J[H]e.setPaletteColor(E[H],K[1]/255,K[2]/255,K[3]/255)end end;local L={{91,18,3},{148,49,7},{189,66,7},{225,105,10},{231,146,42},{237,187,74},{252,213,174}}local M=0.4;local N=0.6;local O=0.7;local P={{91*M,18*N,3*O},{148*M,49*N,7*O},{189*M,66*N,7*O},{225*M,105*N,10*O},{231*M,146*N,42*O},{237*M,187*N,74*O},{252*M,213*N,174*O}}local Q={sky=colors.black,clouds=colors.lightGray,foliage=colors.magenta,foliageDark=colors.pink,treeBark=colors.lightBlue,tableTop=colors.gray,uiAccent=E[#E],uiBG=colors.magenta,shavedPumpkin=colors.purple}local R={skyDay={175/255,170/255,224/255},skyNight={17/255,0/255,47/255},cloudsDay={206/255,206/255,225/255},cloudsNight={96/255,96/255,170/255},foliageDarkNight={8/255,54/255,73/255},foliageDarkDay={103/255,107/255,29/255},foliageDay={121/255,160/255,20/255},foliageNight={22/255,81/255,70/255},treeBarkDay={91/255,62/255,33/255},treeBarkNight={30/255,29/255,26/255},tableTopDay={211/255,135/255,91/255},tableTopNight={61/255,45/255,21/255},shavedPumpkinDay={234/255,220/255,159/255}}e.frame:setBackgroundColor(Q.sky)local function S()if D then I(P)e.setPaletteColor(Q.sky,R.skyNight)e.setPaletteColor(Q.clouds,R.cloudsNight)e.setPaletteColor(Q.foliageDark,R.foliageDarkNight)e.setPaletteColor(Q.foliage,R.foliageNight)e.setPaletteColor(Q.treeBark,R.treeBarkNight)e.setPaletteColor(Q.tableTop,R.tableTopNight)else I(L)e.setPaletteColor(Q.sky,R.skyDay)e.setPaletteColor(Q.clouds,R.cloudsDay)e.setPaletteColor(Q.foliageDark,R.foliageDarkDay)e.setPaletteColor(Q.foliage,R.foliageDay)e.setPaletteColor(Q.treeBark,R.treeBarkDay)e.setPaletteColor(Q.tableTop,R.tableTopDay)e.setPaletteColor(Q.shavedPumpkin,R.shavedPumpkinDay)end;f.recomputeColorDistances(term)end;S()local function T()local U={}local V=7;local W=20;local X=math.random(5,9)if not B then X=math.random(5,7)W=15 end;local Y=math.random()+1;local Z={}for H=0,W do local _=H/W;local a0=Y*(_-0.5)^2+1;Z[H]=a0 end;for H=1,X do local a1=H%2==0 and colors.orange or colors.red;local a2=math.random()*1.5+0.1;for a3=1,W do local a4=0.5*b((a3-1)/W*a)local a5=0.5*b(a3/W*a)local a6=0.5*d(1-a4*2*a4*2)*Z[a3-1]local a7=0.5*d(1-a5*2*a5*2)*Z[a3]local function a8(_,a9)local aa=1-math.min(a9,1-a9)^3*a2;local ab=b(_/X*a*2)*aa;local ac=c(_/X*a*2)*aa;return ab,ac end;local ad=V-1;for ae=1,ad do local a9=(ae-1)/ad;local af,ag=a8(H+a9,a9)local ah,ai=a8(H+a9+1/ad,a9+1/ad)local aj=(1-math.abs(a4)*2)^1;local ak=0.25+2*-math.abs(a9+0.5/ad-0.5)^2*aj;local al=(a4+0.5)^0.25-1;local G=0.5+ak+al;local am=F(G+math.random()*0.1)local an=F(G+math.random()*0.1)U[#U+1]={x1=af*a6,y1=a4,z1=ag*a6,x2=ah*a7,y2=a5,z2=ai*a7,x3=af*a7,y3=a5,z3=ag*a7,c=am}U[#U+1]={x1=ah*a7,y1=a5,z1=ai*a7,x2=af*a6,y2=a4,z2=ag*a6,x3=ah*a6,y3=a4,z3=ai*a6,c=an}end end end;local ao=(math.random()-0.5)*0.5;local ap=(math.random()-0.5)*0.5;local aq=(math.random()-0.5)*0.5;local ar=0.5;local as=0.5;local function at(ab,au,ac)local av=ao-ab;local aw=ap-au;local ax=aq-ac;local ay=ar^av*as;local az=ar^aw*as;local aA=ar^ax*as;return ab+ay,au+az,ac+aA end;for H=1,#U do local aB=U[H]aB.x1,aB.y1,aB.z1=at(aB.x1,aB.y1,aB.z1)aB.x2,aB.y2,aB.z2=at(aB.x2,aB.y2,aB.z2)aB.x3,aB.y3,aB.z3=at(aB.x3,aB.y3,aB.z3)end;U=e.Pine3D.transforms.center(U)U=e.Pine3D.transforms.normalizeScale(U)U=e.Pine3D.transforms.alignBottom(U)local aC=1;for H=1,#U do local aB=U[H]local aD={}for ae,aE in pairs(aB)do aD[ae]=aE end;aD.x1=aB.x1*aC;aD.y1=aB.y1*aC;aD.z1=aB.z1*aC;aD.x2=aB.x3*aC;aD.y2=aB.y3*aC;aD.z2=aB.z3*aC;aD.x3=aB.x2*aC;aD.y3=aB.y2*aC;aD.z3=aB.z2*aC;aD.c=colors.brown;U[#U+1]=aD end;return U end;local aF=g:add(T(),0,0,0)local aG=e.model("models/skybox3.stab"):invertTriangles():center():translate(nil,0.3):rotate(nil,-math.pi*0.5,nil):scale(1)aG:mapColor({[colors.green]=Q.foliageDark,[colors.lime]=Q.foliage})local aH=g:addEnv(aG)local aI=g:addEnv(e.model("models/clouds.stab",{skipNormalize=true}):invertTriangles():scale(2):mapColor({[colors.white]=Q.clouds}))local aJ=e.model("models/table.stab"):invertTriangles():center():scale(2.5):invertTriangles():mapColor({[colors.white]=Q.tableTop})local aK=g:add(aJ,0,-1.25,0)local function aL()local aM=os.epoch("utc")local U=aF.pineObject[7]for H=1,#U do local aB=U[H]if aB[13]then return end;aB[13]=H end;local aN=math.abs;local aO=0.01;local function aP(aQ,aR)local aS=0;for H=0,2 do for a3=0,2 do local aT=aN(aQ[H*3+1]-aR[a3*3+1])local aU=aN(aQ[H*3+2]-aR[a3*3+2])local aV=aN(aQ[H*3+3]-aR[a3*3+3])if aT+aU+aV<=aO then aS=aS+1;break end end;if H==2 and aS==0 then return false end end;return aS>=2 end;local aW=0.45^2;if not B then aW=0.55^2 end;for H=1,#U do local aX=U[H]if aX[11]==colors.brown then aX[14]={}else local aY={}for a3=1,#U do local aZ=U[a3]if H~=a3 then local aT=aX[1]-aZ[1]local aU=aX[2]-aZ[2]local aV=aX[3]-aZ[3]local a_=aT*aT+aU*aU+aV*aV;if a_<aW then if aP(aX,aZ)then aY[#aY+1]=a3 end end end end;aX[14]=aY end end;local b0=os.epoch("utc")e.log("Init connections took "..b0-aM.." ms")end;aL()aI:on("update",function(b1)local b2=C*math.pi*2*0.003;b2=b2+math.sin(C*0.2)*math.pi*0.015;aI:setPos(nil,nil,nil,nil,b2)end)local b3=math.pi*0.02;local b4=1.61803398875;local b5=50;if not B then b5=25 end;for H=10,9+b5 do local _=H*b4*math.pi*2;local b6=H*1;local ab=math.sin(_)*b6;local ac=math.cos(_)*b6;local b7=math.random()*0.5+1;local b8=e.model("models/pinetree2.stab"):alignBottom():scale(10*b7):rotate(nil,math.random()*math.pi*2)b8:mapColor({[colors.green]=Q.foliageDark,[colors.lime]=Q.foliage,[colors.brown]=Q.treeBark})local b9=g:add(b8,ab,-2.5,ac)b9:on("update",function(b1)local ba=math.sin(C*0.5+ab*0.2)*b3;local bb=math.cos(C*0.2+ac*0.2)*b3;b9:setPos(nil,nil,nil,ba,nil,bb)end)end;local bc=os.clock()if not fs.exists("pumpkins")then fs.makeDir("pumpkins")end;local bd={}local be=1;local function bf()local bg=fs.list("pumpkins")bd={}be=1;for H=1,#bg do local bh=bg[H]if bh:sub(-5,-1)==".stab"then local bi=bh:sub(1,-6)bd[#bd+1]=bi;be=math.max(be,#bi)end end end;bf()local function bj(U,ab,au,ac,bk,bl)if#U<=0 then return end;if bl then e.audio.playSound("entity.sheep.shear",0.2,math.random()*0.5+1)else if#U>1 then if math.random(1,2)==1 then e.audio.playSound("block.wood.hit")else e.audio.playSound("block.wood.break")end else if math.random(1,2)==1 then e.audio.playSound("block.stem.break",0.2)else e.audio.playSound("block.shroomlight.hit",0.2)end end end;bk=bk or 1;local bm=(math.random()-0.5)*4*bk;local bn=(math.random()-0.5)*4*bk;local bo=(math.random()-0.5)*4*bk;local bp=g:add(U,ab,au,ac)local bq=C;local br=ab;local bs=au;local bt=ac;bp:on("update",function(b1)local bu=C-bq;bs=bs-7*b1;local aT=br*b1;local aU=bs*b1;local aV=bt*b1;local bv=bp.x+aT;local bw=bp.y+aU;local bx=bp.z+aV;bp:setPos(bv,bw,bx,bu*math.pi*bm,bu*math.pi*bn,bu*math.pi*bo)if bu>1 then bp:remove()end end)end;local function by(aB,bl)if aB[11]==colors.brown then return end;local af=aB[1]local a4=aB[2]local ag=aB[3]local ah=aB[4]local a5=aB[5]local ai=aB[6]local bz=aB[7]local bA=aB[8]local bB=aB[9]local U={{x1=af-af,y1=a4-a4,z1=ag-ag,x2=ah-af,y2=a5-a4,z2=ai-ag,x3=bz-af,y3=bA-a4,z3=bB-ag,c=aB[11],forceRender=true}}bj(U,af,a4,ag,nil,bl)end;local bC=0;local bD=true;local function bE()local U=aF.pineObject[7]local bF={}for H=1,#U do local aB=U[H]local bG=aB[13]bF[bG]=H end;local bH={}local bI={}local bJ=0;local bK={1}local aM=os.epoch("utc")while#bK>0 do local H=table.remove(bK,1)bH[H]=true;bJ=bJ+1;local aB=U[H]local bL=aB[14]for a3=1,#bL do local bG=bL[a3]local bM=bF[bG]if bM and not bH[bM]and not bI[bM]then bK[#bK+1]=bM;bI[bM]=true end end end;e.log("Visited: "..bJ.." / "..#U)local b0=os.epoch("utc")e.log("broken check took "..b0-aM.." ms")if bJ>#U*0.5 then local bN={}local bO=0;local bP=0;local bQ=0;for a3=#U,1,-1 do if not bH[a3]then local aB=U[a3]if aB[11]~=colors.brown then bO=bO+aB[1]bP=bP+aB[2]bQ=bQ+aB[3]bN[#bN+1]={x1=aB[1],y1=aB[2],z1=aB[3],x2=aB[4],y2=aB[5],z2=aB[6],x3=aB[7],y3=aB[8],z3=aB[9],c=aB[11],forceRender=true}end;table.remove(U,a3)end end;local bR=bO/#bN;local bS=bP/#bN;local bT=bQ/#bN;for H=1,#bN do local aB=bN[H]aB.x1=aB.x1-bR;aB.y1=aB.y1-bS;aB.z1=aB.z1-bT;aB.x2=aB.x2-bR;aB.y2=aB.y2-bS;aB.z2=aB.z2-bT;aB.x3=aB.x3-bR;aB.y3=aB.y3-bS;aB.z3=aB.z3-bT end;bj(bN,bR,bS,bT,0.5)else local bN={}local bO=0;local bP=0;local bQ=0;for a3=#U,1,-1 do if bH[a3]then local aB=U[a3]if aB[11]~=colors.brown then bO=bO+aB[1]bP=bP+aB[2]bQ=bQ+aB[3]bN[#bN+1]={x1=aB[1],y1=aB[2],z1=aB[3],x2=aB[4],y2=aB[5],z2=aB[6],x3=aB[7],y3=aB[8],z3=aB[9],c=aB[11],forceRender=true}end;table.remove(U,a3)end end;local bR=bO/#bN;local bS=bP/#bN;local bT=bQ/#bN;for H=1,#bN do local aB=bN[H]aB.x1=aB.x1-bR;aB.y1=aB.y1-bS;aB.z1=aB.z1-bT;aB.x2=aB.x2-bR;aB.y2=aB.y2-bS;aB.z2=aB.z2-bT;aB.x3=aB.x3-bR;aB.y3=aB.y3-bS;aB.z3=aB.z3-bT end;bj(bN,bR,bS,bT,0.5)bE()end;local bU=os.epoch("utc")e.log("spawning particle mesh took "..bU-b0 .." ms")end;g:on("update",function(b1)C=C+b1;local bV=os.epoch("utc")if not bD and bV>bC+A then bE()bD=true end;if not n then local bW=g.camera;local bX=e.isDown;if bX[keys.a]or bX[keys.left]then x=x+r*b1 end;if bX[keys.d]or bX[keys.right]then x=x-r*b1 end;if bX[keys.w]or bX[keys.up]then w=w-s*b1 elseif bX[keys.s]or bX[keys.down]then w=w+s*b1 end;w=math.min(y,math.max(z,w))local au=math.sin(w)*v+1;local bY=math.cos(w)*v;local ab=math.cos(x)*bY;local ac=math.sin(x)*bY;bW:setPos(ab,au,ac,nil,math.deg(x),math.deg(w)+180)end;if D then local bZ=os.clock()if bZ>bc+0.1 then bc=bZ;local a0=math.random()*0.5+1.5;local _=130;local b_=60;local c0=0;_=math.min(255,_*a0)b_=math.min(255,b_*a0)c0=math.min(255,c0*a0)e.setPaletteColor(colors.brown,_/255,b_/255,c0/255)a0=a0*0.25+1.75*0.75;local _=89;local b_=38;local c0=0;_=math.min(255,_*a0)b_=math.min(255,b_*a0)c0=math.min(255,c0*a0)e.setPaletteColor(Q.shavedPumpkin,_/255,b_/255,c0/255)end else e.setPaletteColor(colors.brown,107/255,29/255,11/255)end;local c1=j.controlBar.win;c1.setBackgroundColor(Q.uiBG)c1.clear()c1.setCursorPos(1,1)local h,i=term.getSize()if n then c1.reposition(1,i,h,1)for H=1,#k do local c2=k[H]if l==H then c1.setTextColor(Q.uiAccent)c1.write("[")c1.setTextColor(colors.white)c1.write(c2)c1.setTextColor(Q.uiAccent)c1.write("]")else c1.setTextColor(colors.white)c1.write(" "..c2 .." ")end end elseif not o then c1.setTextColor(colors.white)local c3="Press Ctrl to access menu"c1.write(c3)c1.reposition(1,i,#c3,1)else c1.reposition(1,i+1,1,1)end;local c4=j.subMenu.win;if n and p then local c2=k[l]local c5=0;for H=1,#k do local c6=k[H]if c6==c2 then break end;c5=c5+#c6+2 end;if c2=="Save"then local c7="Name: "..q;c4.reposition(1+c5,i-1,math.max(20,#c7+1),1)c4.setBackgroundColor(Q.uiBG)c4.clear()c4.setTextColor(colors.white)c4.setCursorPos(1,1)c4.write(c7)else c4.reposition(1+c5,i-#bd,be+1,#bd)c4.setBackgroundColor(Q.uiBG)c4.clear()for H=1,#bd do local bi=bd[H]if m==H then c4.setCursorPos(1,H)c4.setTextColor(Q.uiAccent)c4.write(">")c4.setTextColor(colors.white)c4.write(bi)else c4.setTextColor(colors.white)c4.setCursorPos(1,H)c4.write(" "..bi)end end end else c4.reposition(1,i+1,1,1)end end)local c8={x=nil,y=nil}local function c9(ab,au,ca)local cb,cc=e.frame:getObjectIndexTrace({aF.pineObject},ab,au)if cb then local U=aF.pineObject[7]local cd=U[cc]if cd[11]==colors.brown then return end;local ce=(cd[1]+cd[4]+cd[7])/3;local cf=(cd[2]+cd[5]+cd[8])/3;local cg=(cd[3]+cd[6]+cd[9])/3;local ch=ca*ca;for H=#U,1,-1 do local aB=U[H]local ab=(aB[1]+aB[4]+aB[7])/3;local au=(aB[2]+aB[5]+aB[8])/3;local ac=(aB[3]+aB[6]+aB[9])/3;local aT=ce-ab;local aU=cf-au;local aV=cg-ac;local a_=aT*aT+aU*aU+aV*aV;if a_<ch then by(aB)table.remove(U,H)end end;bC=os.epoch("utc")bD=false;local U=aF.pineObject[7]if#U==0 then error("WHY WOULD YOU DO THAT??? WHY WOULD YOU REMOVE THE ENTIRE PUMPKIN??? How can you even call this a carving smh...")end end end;local function ci(ab,au,ca)local cb,cc=e.frame:getObjectIndexTrace({aF.pineObject},ab,au)if cb then local U=aF.pineObject[7]local cd=U[cc]if cd[11]==colors.brown then return end;local ce=(cd[1]+cd[4]+cd[7])/3;local cf=(cd[2]+cd[5]+cd[8])/3;local cg=(cd[3]+cd[6]+cd[9])/3;local ch=ca*ca;for H=#U,1,-1 do local aB=U[H]if aB[11]~=Q.shavedPumpkin then local ab=(aB[1]+aB[4]+aB[7])/3;local au=(aB[2]+aB[5]+aB[8])/3;local ac=(aB[3]+aB[6]+aB[9])/3;local aT=ce-ab;local aU=cf-au;local aV=cg-ac;local a_=aT*aT+aU*aU+aV*aV;if a_<ch then if aB[11]~=colors.brown then by(aB,true)aB[11]=Q.shavedPumpkin end end end end;bC=os.epoch("utc")bD=false;local U=aF.pineObject[7]if#U==0 then error("WHY WOULD YOU DO THAT??? WHY WOULD YOU REMOVE THE ENTIRE PUMPKIN??? How can you even call this a carving smh...")end end end;g:on("mouse_drag",function(cj,ab,au)if cj==1 then if D then return end;local ck=e.isDown[keys.leftShift]if ck then ci(ab,au,0.01)else c9(ab,au,0.01)end;if c8.x and c8.y and B then local aT=ab-c8.x;local aU=au-c8.y;local cl=(math.abs(aT)+math.abs(aU))*2;for H=1,cl do local a0=(H-1)/cl;local cm=c8.x+aT*a0;local cn=c8.y+aU*a0;if ck then ci(cm,cn,0.05)else c9(cm,cn,0.05)end end end elseif cj==2 then if c8.x and c8.y then local aT=ab-c8.x;local aU=au-c8.y;aT=aT/h;aU=aU/i;local a0=2;x=x+r*aT*a0;w=w-s*aU*a0;w=math.min(y,math.max(z,w))local au=math.sin(w)*v+1;local bY=math.cos(w)*v;local ab=math.cos(x)*bY;local ac=math.sin(x)*bY;local bW=g.camera;bW:setPos(ab,au,ac,nil,math.deg(x),math.deg(w)+180)end end;c8.x=ab;c8.y=au end)g:on("mouse_up",function(cj,ab,au)c8.x=nil;c8.y=nil end)g:on("mouse_click",function(cj,ab,au)c8.x=ab;c8.y=au;if cj==1 then if D then return end;local ck=e.isDown[keys.leftShift]if ck then ci(ab,au,0.01)else c9(ab,au,0.01)end end end)local function co(cp)local U={}for H=1,#cp do local cq=cp[H]U[H]={x1=cq[1],y1=cq[2],z1=cq[3],x2=cq[4],y2=cq[5],z2=cq[6],x3=cq[7],y3=cq[8],z3=cq[9],forceRender=cq[10],c=cq[11],outlineColor=cq[12]}end;local cr=textutils.serialise(U)return cr end;local function cs(cp,ct)local cu={}local cv=1;local function cw(ab,au,ac)local cx=ab..","..au..","..ac;if cu[cx]then return cu[cx]end;local cy={nr=cv,x=ab,y=au,z=ac}cv=cv+1;cu[cx]=cy;return cy end;local cz={}local cA=1;local function cB(cC)if cz[cC]then return cz[cC]end;local cD="unknown"for bi,a1 in pairs(colors)do if cC==a1 then cD=bi;break end end;local cE={nr=cA,color=cC,colorName=cD}cA=cA+1;cz[cC]=cE;return cE end;local cF={}for H=1,#cp do local cq=cp[H]local cG=cw(cq[1],cq[2],cq[3])local cH=cw(cq[4],cq[5],cq[6])local cI=cw(cq[7],cq[8],cq[9])local cE=cB(cq[11])cF[H]={v={cG,cH,cI},mat=cE}end;local function cJ(cG,cH,cI)local cK=cH.x-cG.x;local cL=cH.y-cG.y;local cM=cH.z-cG.z;local cN=cI.x-cG.x;local cO=cI.y-cG.y;local cP=cI.z-cG.z;local cQ=cL*cP-cM*cO;local cR=cM*cN-cK*cP;local cS=cK*cO-cL*cN;local cT=math.sqrt(cQ*cQ+cR*cR+cS*cS)if cT==0 then return end;return cQ/cT,cR/cT,cS/cT end;local cU="# exported from Pumpkin Carver\nmtllib "..ct..".mtl\n\n"local cV=""local cW={}for cx,cy in pairs(cu)do cW[cy.nr]=cy end;for H=1,#cW do local cy=cW[H]cU=cU.."v "..cy.x.." "..cy.y.." "..cy.z.."\n"end;table.sort(cF,function(cX,c0)return cX.mat.color>c0.mat.color end)cU=cU.."\n"local cY=""local cZ=nil;for cx,c_ in pairs(cF)do if cZ~=c_.mat then cY=cY.."usemtl mat"..c_.mat.nr.."_"..c_.mat.colorName.."\n"cZ=c_.mat end;local d0=c_.v;local d1,d2,d3=cJ(d0[1],d0[2],d0[3])d1=d1 or 0;d2=d2 or 0;d3=d3 or 0;cV=cV.."vn "..d1 .." "..d2 .." "..d3 .."\n"cY=cY.."f "..d0[1].nr.."//"..cx.." "..d0[2].nr.."//"..cx.." "..d0[3].nr.."//"..cx.."\n"end;cU=cU..cV;cU=cU.."\n"cU=cU..cY;local d4="# exported from Pumpkin Carver\n\n"local function d5(d6)local a1=0;if d6<=0.04045 then a1=d6/12.92 else a1=math.pow((d6+0.055)/1.055,2.4)end;return a1 end;for d7,cE in pairs(cz)do local _,b_,c0=term.getPaletteColor(cE.color)_=d5(_)b_=d5(b_)c0=d5(c0)d4=d4 .."newmtl mat"..cE.nr.."_"..cE.colorName.."\nKd ".._.." "..b_.." "..c0 .."\n\n"end;return cU,d4 end;local function d8(bi)local cp=aF.pineObject[7]local ct="pumpkins/"..bi;local d9={}for H=1,#cp do local da=cp[H]local a0=da[11]==colors.brown and 0.99 or 1;d9[H]={da[1]*a0,da[2]*a0,da[3]*a0,da[4]*a0,da[5]*a0,da[6]*a0,da[7]*a0,da[8]*a0,da[9]*a0,da[10],da[11],da[12]}end;local aM=os.epoch("utc")local db=co(cp)local b0=os.epoch("utc")local cU,d4=cs(d9,ct)local bU=os.epoch("utc")e.log("encoding P3D took "..b0-aM.."ms")e.log("encoding .obj took "..bU-b0 .."ms")local bh=ct..".stab"local dc=fs.open(bh,"w")dc.write(db)dc.close()e.log("Saved to "..bh.."!")local bh=ct..".obj"local dc=fs.open(bh,"w")dc.write(cU)dc.close()e.log("Saved to "..bh.."!")local bh=ct..".mtl"local dc=fs.open(bh,"w")dc.write(d4)dc.close()e.log("Saved to "..bh.."!")end;g:on("char",function(dd)if n and p then local c2=k[l]if c2=="Save"then local a1=string.byte(dd)if a1>=string.byte("a")and a1<=string.byte("z")or a1>=string.byte("A")and a1<=string.byte("Z")or a1>=string.byte("0")and a1<=string.byte("9")then q=q..dd end end end end)g:on("key",function(de)if de==keys.leftCtrl then n=not n;p=false elseif n then if p then local c2=k[l]if c2=="Save"then if de==keys.enter then d8(q)n=false;l=1;bf()e.audio.playSound("entity.experience_orb.pickup",0.3)elseif de==keys.backspace then q=q:sub(1,-2)end elseif c2=="Load"then if de==keys.enter then aF:remove()local bi=bd[m]aF=g:add(e.model("pumpkins/"..bi..".stab",{skipNormalize=true}):alignBottom(),0,0,0)aL()n=false;l=1;e.audio.playSound("block.chest.open",0.3)elseif de==keys.delete then local bi=bd[m]if bi then local ct="pumpkins/"..bi;if fs.exists(ct..".stab")then fs.delete(ct..".stab")end;if fs.exists(ct..".obj")then fs.delete(ct..".obj")end;if fs.exists(ct..".mtl")then fs.delete(ct..".mtl")end;bf()m=math.max(1,math.min(#bd,m))e.audio.playSound("block.anvil.destroy",0.3)end elseif de==keys.up or de==keys.w then m=math.max(1,m-1)elseif de==keys.down or de==keys.s then m=math.min(#bd,m+1)end end else if de==keys.left or de==keys.a then l=math.max(1,l-1)elseif de==keys.right or de==keys.d then l=math.min(#k,l+1)elseif de==keys.enter then local c2=k[l]if c2=="Exit"then os.queueEvent("terminate")elseif c2=="Hide"then o=not o;n=false;l=1 elseif c2=="New"then aF:remove()aF=g:add(T(),0,0,0)aL()n=false;l=1;e.audio.playSound("item.hoe.till",0.3)elseif c2=="Save"then p=true;q=""elseif c2=="Load"then p=true;m=#bd elseif c2=="Showcase"then D=not D;S()n=false;l=1 end end end end end)g:on("mouse_scroll",function(aU)if aU>0 then v=math.min(u,math.max(t,v/0.95))elseif aU<0 then v=math.min(u,math.max(t,v*0.95))end end)term.setBackgroundColor(colors.orange)term.setTextColor(colors.white)term.clear()term.setCursorPos(1,3)print("Click / drag to cut")sleep(0.5)print("Hold Left Shift to shave")sleep(1)print("\nPress any key to continue...")os.pullEvent("key")e.run()